(()=>{"use strict";var e={782:(e,r,t)=>{t.d(r,{L:()=>o});const o=(e,r=200)=>({headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":!0},statusCode:r,body:JSON.stringify(e)})},444:(e,r,t)=>{t.d(r,{z:()=>a});var o=t(806),i=t.n(o),n=t(657),s=t.n(n);const a=e=>i()(e).use(s()())},175:(e,r,t)=>{t.d(r,{m:()=>i});var o=t(440);const i=o.object().shape({title:o.string().required(),description:o.string(),price:o.number().required(),count:o.number().required(),imglink:o.string().required()})},806:e=>{e.exports=require("@middy/core")},657:e=>{e.exports=require("@middy/http-json-body-parser")},723:e=>{e.exports=require("pg")},43:e=>{e.exports=require("source-map-support/register")},440:e=>{e.exports=require("yup")}},r={};function t(o){var i=r[o];if(void 0!==i)return i.exports;var n=r[o]={exports:{}};return e[o](n,n.exports,t),n.exports}t.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},t.d=(e,r)=>{for(var o in r)t.o(r,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};(()=>{t.r(o),t.d(o,{createProduct:()=>p,main:()=>y}),t(43);var e=t(782),r=t(444),i=t(723),n=t(175);const{PG_HOST:s,PG_PORT:a,PG_DATABASE:d,PG_USERNAME:c,PG_PASSWORD:u}=process.env,l={host:s,port:a,database:d,user:c,password:u,ssl:{rejectUnauthorized:!1},connectionTimeoutMillis:5e3},p=async r=>{const t=new i.Client(l);await t.connect();const{title:o,price:s,description:a,imglink:d,count:c}=r.body,u={title:o,price:s,description:a,imglink:d,count:c};console.log(u);let p=!0;try{if(await n.m.isValid(u).then((e=>{p=e})),!p)return(0,e.L)({message:"Insert data is invalid"},400);const r=(await t.query(`insert into products(title, price, description, imglink) values ('${o}', ${s}, '${a}','${d}') returning id`)).rows.find((e=>e)).id;return await t.query(`insert into stocks (product_id, count) VALUES ('${r}', ${c})`),(0,e.L)({message:`New toy ${o} added.`})}catch(r){return(0,e.L)({message:`${r.message}`},500)}finally{t.end()}},y=(0,r.z)(p)})();var i=exports;for(var n in o)i[n]=o[n];o.__esModule&&Object.defineProperty(i,"__esModule",{value:!0})})();
//# sourceMappingURL=handler.js.map